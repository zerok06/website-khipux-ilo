---
import { getRelativeLocaleUrl } from "astro:i18n";
import LanguagePicker from "./LanguagePicker.astro";
import siteData from "../data/site.json";

interface Props {
  locale: string;
}

import features from "../data/features.json";

const { locale } = Astro.props;
let navLinks = siteData.nav[locale as keyof typeof siteData.nav];

// Filter links based on feature flags
navLinks = navLinks.filter((link) => {
  if (link.href.includes("/schedule") && !features.schedule) return false;
  if (link.href.includes("/venue") && !features.venue) return false;
  if (link.href.includes("/team") && !features.team) return false;
  if (link.href.includes("#speakers") && !features.speakers) return false;
  // Registration is handled by CTA usually, but if it's in nav:
  if (link.href.includes("/register") && !features.registration) return false;
  return true;
});

const isEs = locale === "es";
---

<nav
  class="fixed w-full z-50 top-0 start-0 bg-white/95 dark:bg-black/95 backdrop-blur-md border-b border-gray-100 dark:border-gray-800"
>
  <div
    style="max-width: var(--content-max-width, 70%); margin: 0 auto; padding: 0 1rem;"
  >
    <div class="flex items-center justify-between py-3">
      <!-- Logo -->
      <a
        href={getRelativeLocaleUrl(locale, "/")}
        class="flex items-center gap-2"
      >
        <img src="/khipu_logo.png" alt="Logo" class="w-64 h-16" />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              class="text-sm font-medium text-gray-600 hover:text-primary-500 dark:text-gray-300 dark:hover:text-primary-400 transition-colors"
            >
              {link.label}
            </a>
          ))
        }
      </div>

      <!-- Right side -->
      <div class="flex items-center gap-3">
        <LanguagePicker locale={locale} />
        <a
          href="#"
          class="hidden sm:inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-full transition-colors shadow-lg shadow-primary-500/25 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-black"
        >
          {isEs ? "ApÃ³yanos" : "Support Us"}
        </a>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-btn"
          type="button"
          class="md:hidden p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
          aria-label="Open menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-gray-100 dark:border-gray-800 bg-white dark:bg-black"
  >
    <div class="px-4 py-4 space-y-3">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class="block text-base font-medium text-gray-600 hover:text-primary-500 dark:text-gray-300 dark:hover:text-primary-400 py-2"
          >
            {link.label}
          </a>
        ))
      }
      <a
        href="#"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-full transition-colors mt-4"
      >
        Support Us
      </a>
    </div>
  </div>
</nav>

<script is:inline>
  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  menuBtn?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>
